<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Evara Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="adminAssets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="/adminAssets/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="index.html" class="brand-wrap">
                <img src="/adminAssets/imgs/theme/logo.svg" class="logo" alt="Evara Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <%- include('../layouts/adminLayouts/sideBar') %>

          
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar" style="display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
            <!-- Left Section (Empty or Placeholder) -->
            <div style="flex: 1;"></div>
            
            <!-- Center Section (Title) -->
            <h1 class="content-title card-title" style="margin: 0; text-align: center; flex: 1;">SafeCap</h1>
            
            <!-- Right Section (Icons) -->
            <div style="flex: 1; display: flex; justify-content: flex-end; align-items: center;">
                <a class="nav-link btn-icon" href="#" style="margin-right: 15px;">
                    <i class="material-icons md-notifications animation-shake"></i>
                    <span class="badge rounded-pill" style="position: absolute; top: 5px; right: 5px;">3</span>
                </a>
                <a class="nav-link btn-icon darkmode" href="#" style="margin-left: 15px;">
                    <i class="material-icons md-nights_stay"></i>
                </a>
            </div>
        </header>
        
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                    <p>Whole data about your business here</p>
                </div>
                <div>
                    <!-- <a href="/admin/logout" class="btn btn-primary"><i class="text-muted material"></i>Logout</a> -->
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Revenue</h6>
                                <span><%= totalRevenue[0].totalGrandTotal %></span>
                                <span class="text-sm">
                                    Shipping fees are  included
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Orders</h6> <span><%= totalNoOfOrders %></span>
                                <span class="text-sm">
                                    Excluding orders in transit
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Products</h6> <span><%= totalProduct %></span>
                                <span class="text-sm">
                                    In 19 Categories
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Discount</h6> <span><%= totalBrands %></span>
                                <span class="text-sm">
                                    Based on coupons.
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-8 col-lg-12" style="width: 90%">
                    <div style="max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                        <h1 style="text-align: center; color: #333;">Dynamic Bar Chart</h1>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <button onclick="updateChart('today')" style="margin: 5px; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Today</button>
                            <button onclick="updateChart('weekly')" style="margin: 5px; padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Weekly</button>
                            <button onclick="updateChart('monthly')" style="margin: 5px; padding: 10px 20px; background-color: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">Monthly</button>
                            <button onclick="updateChart('yearly')" style="margin: 5px; padding: 10px 20px; background-color: #ffc107; color: white; border: none; border-radius: 4px; cursor: pointer;">Yearly</button>

                        </div>
                        
                        <canvas id="myChart" width="400" height="200"></canvas>                   
                    </div>
                <!-- <div class="col-xl-4 col-lg-12">
                    <button style="padding: 10px 20px; background: #28a745; color:white;  border-radius: 0%;"  onclick="todayChart()">Today</button>
                    <button style="padding: 10px 20px; background: #ffc107; color:white;  border-radius: 0%;" onclick="weeklyChart()">montly</button>
                    <button style="padding: 10px 20px; background: #17a2b8; color:white; border-radius: 0%;" onclick="monthlyChart()">yearly</button>
                </div> -->
            </div>
            <div class="card mb-4">
                <header class="card-header">
                    <h4 class="card-title" style="font-size: 35px;">Sales Report</h4>
                    <div style="width: 90%; max-width: 800px; margin: 40px auto; font-family: Arial, sans-serif;">
                        <!-- Form Section -->
                        <form action="/admin/customReport" method="post" style="display: flex; flex-wrap: wrap; gap: 15px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fefefe; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                            <!-- Date Input 1 -->
                            <div style="flex: 1; min-width: 180px;">
                                <label for="start-date" style="font-size: 14px; color: #333; margin-bottom: 5px; display: block;">Start Date</label>
                                <input type="date" id="start-date" name="startDate" value="2024-11-01" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                            </div>
                    
                            <!-- Date Input 2 -->
                            <div style="flex: 1; min-width: 180px;">
                                <label for="end-date" style="font-size: 14px; color: #333; margin-bottom: 5px; display: block;">End Date</label>
                                <input type="date" id="end-date" name="endDate" value="2024-11-01" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                            </div>
                    
                            <!-- Submit Button -->
                            <div style="min-width: 100px;">
                                <input type="submit" value="Apply" style="padding: 10px 20px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">
                            </div>
                        </form>
                    
                        <!-- Total Amount Section -->
                        <div style="display: flex; justify-content: space-around; align-items: center; margin: 30px auto; flex-wrap: wrap; gap: 20px;">
                            <div style="text-align: center; background-color: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px; width: 100%; max-width: 300px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                                <p style="font-size: 24px; font-weight: bold; color: #007bff; margin: 0;">Total Amount</p>
                                <p style="font-size: 18px; color: #333; margin-top: 10px;"><%= totalAmount %></p>
                            </div>
                        
                            <div style="text-align: center; background-color: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px; width: 100%; max-width: 300px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                                <p style="font-size: 24px; font-weight: bold; color: #007bff; margin: 0;">Total Discount</p>
                                <p style="font-size: 18px; color: #333; margin-top: 10px;"><%= totalCouponDiscountAmount %></p>
                            </div>
                        
                            <div style="text-align: center; background-color: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px; width: 100%; max-width: 300px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                                <p style="font-size: 24px; font-weight: bold; color: #007bff; margin: 0;">Total Orders</p>
                                <p style="font-size: 18px; color: #333; margin-top: 10px;"><%= totalOrders %></p>
                            </div>
                        </div>
                        
                         
                    
                        <!-- Buttons Section -->
                        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                            <a href="/admin/todayReport" style="text-decoration: none;">
                                <button style="padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Today</button>
                            </a>
                            <a href="/admin/weekReport" style="text-decoration: none;">
                                <button style="padding: 10px 20px; background-color: #ffc107; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">This Week</button>
                            </a>
                            <a href="/admin/monthlyReport" style="text-decoration: none;">
                                <button style="padding: 10px 20px; background-color: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">This Month</button>
                            </a>
                        </div>
                    </div>
                    
                    
                    
                    
                    
                </header>
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="table-responsive">
                            <table class="table align-middle table-nowrap mb-0" id="dataTable">

                                <thead class="table-light">
                                    <tr>
                                        <th scope="col" class="text-center">
                                            <div class="form-check align-middle">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck01">
                                                <label class="form-check-label" for="transactionCheck01"></label>
                                            </div>
                                        </th>
                                        <th class="align-middle" scope="col">Date</th>
                                        <th class="align-middle" scope="col">OrderId</th>
                                        <th class="align-middle" scope="col">Price</th>
                                        <th class="align-middle" scope="col">Coupon Discount</th>

                                        <th class="align-middle" scope="col">Tax</th>
                                        <th class="align-middle" scope="col">shipping</th>
                                        <th class="align-middle" scope="col">Total Price</th>
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <% resultArray.forEach(order => { %>
                                        <tr>
                                            <td class="text-center">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="transactionCheck_<%= order._id %>">
                                                    <label class="form-check-label" for="transactionCheck_<%= order._id %>"></label>
                                                </div>
                                            </td>
                                            <td>
                                                <a href="#" class="fw-bold">
                                                    <%= new Date(order.orderDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>
                                                </a>
                                            </td>
                                            <td>
                                                <%= order.id %> 
                                            </td>
                                            <td>
                                                <%= order.subTotal%> 
                                            </td>
                                            <td>
                                                <%= order.couponDiscountAmount %> 
                                            </td>
                                            <td>
                                                <%= order.taxPrice%> 
                                            </td>
                                            <td>
                                                <span class="badge badge-pill badge-soft-success">
                                                    <%= order.shippingPrice %> 
                                                </span>
                                            </td>
                                            <td>
                                                <i class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                                <%= order.total %> 
                                            </td>
                                        </tr>
                                        <% }) %>
                                        
                                    
                                </tbody>
                            </table>
                        </div>
                    </div> <!-- table-responsive end// -->
                </div>
            </div>

            <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-start">

                      <% if (currentPage>1){ %>
                         <li class="page-item ">
                          <a class="page-link" href="?page=<% currentPage-1 %>"><i class="material-icons md-chevron_left"></i></a>
                        </li>
                     <% } %>

                     <% for(let i=1;i<=totalPages;i++){ %>
                      <li class="page-item <%= currentPage===i?"active":''%>">
                        <a class="page-link" href="?page=<%= i %>"><%= ('0'+ i ).slice(-2) %></a>
                      </li>
                    <% } %>

                    <% if(currentPage<totalPages){ %>
                      <li class="page-item">
                        <a class="page-link" href="?page=<%= currentPage + 1 %>"><i class="material-icons md-chevron_right"></i></a>
                      </li>
                   <% } %>
                    </ul>
                </nav>
            </div>



            <div class="mt-4">
                <!-- Button for Download PDF -->
                <button 
                  style="background-color: #006400; color: white; border: none;" 
                  class="btn me-2" 
                  onclick="downloadPDF()">
                  <i class="fas fa-file-pdf"></i> Download PDF
                </button>
                
                <!-- Button for Download Excel -->
                <button 
                  style="background-color: #006400; color: white; border: none;" 
                  class="btn" 
                  onclick="downloadExcel()">
                  <i class="fas fa-file-excel"></i> Download Excel
                </button>
              </div>
              
              
            





        </section> <!-- content-main end// -->
        <footer class="main-footer font-xs">
            <div class="row pb-30 pt-15">
                <div class="col-sm-6">
                    <script>
                    document.write(new Date().getFullYear())
                    </script> ©, Evara - HTML Ecommerce Template .
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end">
                        All rights reserved
                    </div>
                </div>
            </div>
        </footer>
    </main>
    <script src="/adminAssets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/adminAssets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/adminAssets/js/vendors/select2.min.js"></script>
    <script src="/adminAssets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/adminAssets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/adminAssets/js/vendors/chart.js"></script>
    <!-- Main Script -->
    <script src="/adminAssets/js/main.js" type="text/javascript"></script>
    <script src="/adminAssets/js/custom-chart.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="path/to/dropdown-functionality.js"></script>



    

</body>

<script>
    async function downloadPDF() {
  const { jsPDF } = window.jspdf;

  
  const doc = new jsPDF();

  const pageWidth = doc.internal.pageSize.width; 
  const today = new Date().toLocaleDateString();


  doc.setFontSize(30);
  doc.setTextColor(0, 102, 204);
  doc.text("Safe Cap", pageWidth / 2, 15, { align: "center" }); 


  doc.setFontSize(12);
  doc.setTextColor(0, 0, 0)
  doc.text("Headquarters: Bangalore", 14, 25); 
  doc.text("Sales Report", pageWidth / 2, 25, { align: "center" });
  doc.text(`Date: ${today}`, pageWidth - 14, 25, { align: "right" }); 

  const table = document.getElementById("dataTable");


  const headers = [...table.querySelectorAll("thead tr th")].map(th => th.innerText.trim());
  const rows = [...table.querySelectorAll("tbody tr")].map(row =>
    [...row.querySelectorAll("td")].map(td => td.innerText.trim())
  );

  
  doc.autoTable({
    head: [headers],
    body: rows,
    startY: 30, 
    styles: {
      fontSize: 8,
      cellPadding: 2,
    },
  });

  
  doc.save("Order_Details.pdf");
}





function downloadExcel() {
  
  const table = document.getElementById("dataTable");

  
  const workbook = XLSX.utils.book_new(); 
  const worksheet = XLSX.utils.table_to_sheet(table); 

  const today = new Date().toLocaleDateString(); 
  const heading = [
    ["Safe Cap"], 
    ["Sales Report"], 
    [`Date: ${today}`], 
    [], 
  ]

  XLSX.utils.sheet_add_aoa(worksheet, heading, { origin: "A1" });


  XLSX.utils.book_append_sheet(workbook, worksheet, "Order Details");

  
  XLSX.writeFile(workbook, "Order_Details.xlsx");
}







const ctx = document.getElementById('myChart').getContext('2d');
let price

   const chartData = {
        today: {
            labels: ['Today'],
            data: []
        },
        weekly: {
            labels: ['Sunday','Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday' ],
            data: []
        },
        monthly: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            data: []
        },
        yearly: {
            labels: ['jan', 'Feb', 'Mar', 'Apr','May','Jun','July','Aug','Sep','Oct','Nov','Dec'],
            data: []
        }
    };


    // Create initial chart instance
    const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartData.today.labels,
            datasets: [{
                label: 'Total Revenue',
                data: chartData.today.data,
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Function to update chart dynamically
    function updateChart(period) {

        

        fetch("/admin/updateChart", {
    method: "POST",
    headers: {
        "Content-Type": "application/json",
    },
    body: JSON.stringify({
        period: period,
        
    })
})
.then(response => response.json())
.then(data => {
    if(data.success){
      price=data.amount


    chartData[period].data = price;


myChart.data.labels = chartData[period].labels;
myChart.data.datasets[0].data = chartData[period].data;

        myChart.update();
    }
})


    }



  </script>
  

</html>